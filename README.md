📘 README – Telegram Leads System
מערכת ניהול הרשמות, תומכים ומומחים לתנועת אחדות

📌 תקציר המערכת
המערכת היא בוט טלגרם מלא, מבוסס Python + FastAPI + python-telegram-bot, המאפשר:

רישום תומכים

רישום מומחים

ניהול מקומות (Positions)

ניהול קבוצות

ניהול גיליונות Google Sheets

שידור הודעות

תפריטי משתמש, מומחה ואדמין

לוגים מתקדמים

Smart Validation לגיליונות

המערכת בנויה בצורה מודולרית, קלה לתחזוקה, ומותאמת להרחבות עתידיות.

📁 מבנה תיקיות
קוד
campaign1/
│
├── bot/
│   ├── bot_handlers.py          # Router ראשי: start, menu, callbacks
│   ├── admin_handlers.py        # כל פקודות האדמין + תתי תפריטים
│   ├── expert_handlers.py       # תהליך הרשמת מומחה
│   ├── supporter_handlers.py    # תהליך הרשמת תומך
│   ├── keyboards.py             # כל המקלדות (InlineKeyboardMarkup)
│   ├── states.py                # כל ה־Conversation states
│
├── services/
│   ├── sheets_service.py        # כל העבודה מול Google Sheets
│   ├── logger_service.py        # לוגים לקבוצת לוגים
│
├── utils/
│   ├── constants.py             # כל הקבועים, callback data, ENV
│
├── main.py                      # נקודת כניסה לבוט + webhook + startup
├── requirements.txt             # ספריות Python
└── README.md                    # קובץ זה
🧠 סקירת עומק – מה המערכת עושה
1. רישום תומכים
תהליך מלא עם שאלות: שם, עיר, אימייל, טלפון, פידבק

שמירה בגיליון Users

קישור אישי לשיתוף

תפריט תומך עם פרופיל

2. רישום מומחים
תהליך מלא: שם, תחום, ניסיון, מקום, קישורים, למה אתה מתאים

שמירה בגיליון Experts

סטטוס: pending / approved / rejected

קישור מומחה אישי

תפריט מומחה עם מידע מלא

3. ניהול מקומות (Positions)
צפייה בכל המקומות

שיוך מומחה למקום

איפוס מקום

איפוס כל המקומות

תפריט אדמין להצגת מקומות

4. ניהול גיליונות Google Sheets
כולל מנגנון Smart Validation:

בדיקת כותרות

תיקון כותרות אוטומטי

ניקוי כפילויות

בדיקת תקינות מלאה

תפריט אדמין ייעודי לניהול גיליונות

5. ניהול קבוצות
הצגת מזהי קבוצות

שימוש ב־ENV

שידור הודעות לתומכים / מומחים

6. תפריטי משתמש
תפריט ראשי

תפריט תומך

תפריט מומחה

תפריט אדמין

תתי תפריטים: גיליונות, שידור, יצוא, ניווט מהיר

7. לוגים
כל פעולה משמעותית נרשמת

נשלחת לקבוצת לוגים

כולל פרמטרים חשובים

🚀 מה כבר בוצע (גרסה נוכחית)
✔ שדרוג מלא של admin_handlers
כולל:

ניהול גיליונות

שידור

יצוא

ניווט מהיר

מומחים ממתינים

חיפוש

רשימות

✔ שדרוג keyboards
כולל:

תפריט אדמין מקצועי

תפריט מומחה משופר

תפריט תומך משופר

תפריט ראשי ברור

✔ שדרוג bot_handlers
כולל:

Router נקי

טיפול בכל callback

תמיכה בתתי תפריטים

תמיכה ב־Smart Validation

✔ Smart Validation
תיקון כותרות

בדיקת תקינות

ניקוי כפילויות

תפריט גיליונות

✔ מבנה פרויקט נקי
מודולריות

קבצים מופרדים

קוד קריא

🛣️ מפת דרכים (Roadmap)
🔹 שלב 1 — שיפורים קלים (1–3 ימים)
1. הוספת מערכת הרשאות מתקדמת
תפקידים נוספים: מנהל־על, מנהל־מומחים, מנהל־תומכים

הרשאות לפי תפריט

2. שיפור תהליך מומחה
אימות קישורים

בדיקת שדות חובה

תמיכה בקבצים (PDF קורות חיים)

3. שיפור תהליך תומך
אימות אימייל

אימות טלפון

שדות נוספים

4. שיפור Smart Validation
בדיקת סוגי נתונים

בדיקת תאריכים

בדיקת user_id כפולים בזמן אמת

🔹 שלב 2 — פיצ'רים בינוניים (3–7 ימים)
1. מערכת Dashboard (ללא UI חיצוני)
פקודה /dashboard

הצגת סטטיסטיקות:

כמה תומכים

כמה מומחים

כמה מאושרים

כמה ממתינים

כמה מקומות תפוסים

2. מערכת דיווחים
/report_daily

/report_weekly

/report_positions

3. מערכת תגובות אוטומטיות
הודעות ברירת מחדל

הודעות מותאמות לפי סטטוס

🔹 שלב 3 — פיצ'רים מתקדמים (שבוע+)
1. מערכת CRM פנימית
מעקב אחרי כל משתמש

תיעוד פעולות

תיעוד הפניות

2. מערכת תורים למומחים
מומחים ממתינים

תעדוף

ניהול עומסים

3. אינטגרציה עם Google Drive
שמירת קבצים

שמירת מסמכים

4. אינטגרציה עם API חיצוניים
אימות אימייל

אימות טלפון

אימות זהות

🧩 מה אפשר לשפר בקלות בתוך המבנה הקיים
✔ הוספת פקודות חדשות
המערכת בנויה כך שקל להוסיף פקודות.

✔ הוספת תתי תפריטים
ה־callbackים כבר בנויים בצורה מודולרית.

✔ הוספת גיליונות חדשים
sheets_service.py בנוי כך שקל להוסיף גיליון נוסף.

✔ הוספת שדות חדשים למומחה/תומך
פשוט להוסיף state + שדה בגיליון.

✔ הוספת לוגים
המערכת כבר כוללת logger מובנה.

🧑‍💻 הוראות למפתחים חדשים
1. להבין את ה־flow
הכול מתחיל ב־main.py → bot_handlers.py → תתי־handlers.

2. להבין את Google Sheets
כל הנתונים נשמרים בגיליונות:

Users

Experts

Positions

3. להבין את Smart Validation
ריצה אוטומטית ב־startup.

4. להבין את התפריטים
כל תפריט = callback + keyboard.

5. להבין את ConversationHandler
משמש לרישום תומך/מומחה.

🧱 טכנולוגיות
Python

FastAPI

python-telegram-bot v20

Google Sheets API

Railway (deployment)

🏁 סיכום
המערכת שלך עכשיו:

יציבה

מודולרית

קלה לתחזוקה

מוכנה להרחבות

עם תפריטים מקצועיים

עם Smart Validation

עם פאנל אדמין מלא

ואתה יכול להמשיך לפתח אותה בקלות.

אם תרצה — אני יכול גם:

להכין גרסת README באנגלית

להכין דיאגרמת זרימה (Flowchart)

להכין ERD של הגיליונות

להכין מסמך API


עדכון התקדמות: 
README.md (מלא, כולל מערכת בחירות מומחים וצעדי בדיקה)
markdown
# Campaign1 — Telegram Leads System

📘 מערכת ניהול הרשמות, תומכים ומומחים לתנועת אחדות  
טכנולוגיות: Python, FastAPI, python-telegram-bot, Google Sheets

---

## תקציר המערכת
המערכת היא בוט טלגרם שמאפשר:
- רישום תומכים (Users)
- רישום מומחים (Experts) עם תהליך אישור אדמין
- ניהול מקומות (Positions)
- מערכת בחירות מומחים ודירוג (Leaderboard)
- שידור הודעות לקבוצות
- ניהול וגיבוי נתונים בגוגל שיטס
- פאנל אדמין עם כלים לניהול וגיבוי
- ניטור בסיסי ומדדים (Monitoring)

---

## מבנה הפרויקט (קבצים עיקריים)
campaign1/
├── bot/
│   ├── core/
│   │   ├── locale_service.py
│   │   ├── monitoring.py
│   │   ├── rate_limiter.py
│   │   ├── session_manager.py
│   │   └── telemetry.py
│   ├── flows/
│   │   ├── start_flow.py
│   │   └── menu_flow.py
│   ├── handlers/
│   │   ├── bot_handlers.py
│   │   ├── admin_handlers.py
│   │   ├── expert_handlers.py
│   │   ├── supporter_handlers.py
│   │   └── donation_handlers.py
│   ├── ui/
│   │   └── keyboards.py
│   └── states.py
├── services/
│   ├── sheets_service.py
│   └── logger_service.py
├── utils/
│   └── constants.py
├── main.py
└── README.md

קוד

---

## משתני סביבה חיוניים
יש להגדיר את המשתנים הבאים בסביבת ההרצה (Railway או אחרת):
- `TELEGRAM_BOT_TOKEN`
- `WEBHOOK_URL`
- `GOOGLE_SHEETS_SPREADSHEET_ID`
- `GOOGLE_CREDENTIALS_JSON` (תוכן JSON של חשבון שירות)
- `ADMIN_IDS` (מזהי אדמינים, מופרדים בפסיקים)
- `LOG_GROUP_ID` (אופציונלי אך מומלץ)
- `SUPPORT_GROUP_ID` (אופציונלי)
- `EXPERTS_GROUP_ID` (אופציונלי)
- `USERS_SHEET_NAME`, `EXPERTS_SHEET_NAME`, `POSITIONS_SHEET_NAME` (אופציונלי)

---

## מערכת בחירות מומחים ודירוג (Leaderboard)

### מה זה עושה
- כל מומחה מקבל שדה `supporters_count` בגיליון `Experts`.
- משתמשים יכולים "לתמוך במומחה" מתוך פרופיל המומחה (כפתור 👍).
- תמיכה אחת למשתמש לכל מומחה; תמיכה חוזרת תימנע.
- המערכת מעדכנת את `supporters_count` בגיליון ומציגה את ה‑Leaderboard לכל המשתמשים.

### זרימת עבודה
1. משתמשים נרשמים כתומכים או כמומחים.
2. מומחה מגיש מועמדות → `status: pending`.
3. אדמין מאשר → `status: approved`.
4. משתמשים יכולים לצפות ב‑Leaderboard ולתמוך במומחה.
5. תמיכה מעדכנת את `supporters_count` בגיליון.

---

## בדיקות קצה‑לקצה מומלצות (Smoke + Functional)

**לפני בדיקות**
1. גבה את הקבצים הנוכחיים.
2. ודא שכל משתני הסביבה מוגדרים.
3. החלף את הקבצים בפרויקט עם הקבצים החדשים.

**רשימת בדיקות**
1. `/start` — בדוק קרוסלת פתיחה ותפריט סיום.
2. `/menu` — בדוק תפריט ראשי ותפריטי משנה.
3. הרשמת תומך מלאה — ודא שורה ב‑Users עם `created_at`.
4. הרשמת מומחה מלאה — ודא שורה ב‑Experts עם `status: pending`.
5. אישור מומחה (אדמין) — ודא `status: approved`.
6. `/leaderboard` — ודא דירוג לפי `supporters_count`.
7. פרופיל מומחה — פתח ולחץ על "תמיכה במומחה זה" — ודא עדכון בגיליון.
8. בדוק מניעת תמיכה כפולה (לחיצה שנייה לא מגדילה).
9. בדוק פקודות אדמין: `/positions`, `/sheet_info`, `/fix_sheets`, `/clear_user_duplicates`.
10. בדוק שידור: `/broadcast_supporters <טקסט>` (אם SUPPORT_GROUP_ID מוגדר).
11. בדוק Donate: פתח תפריט Donate ולחץ על כפתורים (קישורים/העתקה/מידע).
12. בדוק לוגים בקבוצת LOG_GROUP_ID (אם מוגדר).

---

## הערות תפעוליות
- **Smart Validation**: ב‑startup המערכת מריצה בדיקות על מבנה הגיליונות ומנסה לתקן כותרות במידת הצורך.
- **Concurrency**: `sheets_service` משתמש במנעולים וב‑retry כדי למנוע race conditions.
- **גיבוי**: מומלץ לגבות את הגיליונות לפני ביצוע שינויים מבניים.
- **הרחבות עתידיות**: ניתן להוסיף אימות אימייל/טלפון, דוחות אוטומטיים, אינטגרציה עם TON API ועוד.

---

## סיכום
המערכת מוכנה להפצה לאחר בדיקות קצה‑לקצה.  
אם תרצה, אני יכול להכין עבורך:
- סקריפט בדיקות אוטומטיות פשוט (Python) שמבצע את התרחישים הנ"ל.
- גרסת README באנגלית.
- דיאגרמת זרימה (Flowchart) ו‑ERD של הגיליונות.
